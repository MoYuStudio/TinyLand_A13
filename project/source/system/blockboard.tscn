[gd_scene load_steps=2 format=3 uid="uid://boovn5g7ep7qt"]

[sub_resource type="GDScript" id="GDScript_s1kb0"]
script/source = "
extends Control

const class_original = preload('res://source/object/blockboard_class.tscn')

var group_list = []
var the_group

var class_data = {
	0:{
		'name':'0',
		'button_icon':'res://resource/graphics/tile/side/building_cabin.png',
		'button_data':{
			0:{
				'name':'0',
				'id':1,
				'money':100,
				'soil':10,
				'wood':0,
				'stone':0,
				'iron':0,
				'gold':0,
			},
			
		},
	},
	1:{
		'name':'0',
		'button_icon':'res://resource/graphics/tile/side/building_cabin.png',
		'button_data':{
			0:{
				'name':'0',
				'id':1,
				'money':100,
				'soil':10,
				'wood':0,
				'stone':0,
				'iron':0,
				'gold':0,
			},
			
		},
	},
}

var block_be_choose = -1

var blockboard_button_list = []
var blockboard_click_lock = false

func _ready():
	for class_is in class_data:
		var class_instance = class_original.instantiate()
		class_instance.name = class_data[class_is]['name']
		class_instance.button_icon = class_data[class_is]['button_icon']
		class_instance.button_data = class_data[class_is]['button_data']
		class_instance.position.x = 1920/6 + 256*class_is
		class_instance.position.y = 1080-151
		# class_instance.Group.rect_position.x = - 256*class_is
		print(class_instance)
		self.add_child(class_instance)
		group_list.append(class_data[class_is]['name'])
	for group_id in len(group_list):
		get_node(group_list[group_id]+'/Group').position.x = -1920/6 - 256*group_id
		get_node(group_list[group_id]+'/Button').text = str(group_list[group_id])
	
	for class_is in class_data:
		blockboard_button_list.append(class_data[class_is]['name']+'/Button')
		for data_id in class_data[class_is]['button_data']:
			var blockboard_id = class_data[class_is]['name'] + \\
								'/Group/Group/HBoxContainer/' + \\
								class_data[class_is]['button_data'][data_id]['name']
			blockboard_button_list.append(blockboard_id+'/Button')
			
		
func _process(delta):
	if Input.is_action_pressed('Esc'):
		for group in group_list:
			get_node(group+'/Button').group_visible = false
			get_node(group+'/Group').visible = false
	for group in group_list:
		if group != the_group:
			if get_node(group+'/Button').group_visible == true:
				the_group = group
				var group_list_coby = group_list
				group_list_coby.erase(group)
				for group_copy in group_list_coby:
					get_node(group_copy+'/Button').group_visible = false
					get_node(group_copy+'/Group').visible = false
				group_list.append(the_group)
	
	for class_is in class_data:
		# print(class_data[class_is]['name'])
		for data_id in class_data[class_is]['button_data']:
			var blockboard_id = class_data[class_is]['name'] + \\
								'/Group/Group/HBoxContainer/' + \\
								class_data[class_is]['button_data'][data_id]['name']
			if get_node(blockboard_id+'/Button').button_click:
				block_be_choose = get_node(blockboard_id).id
	
	for blockboard_button in blockboard_button_list:
		if get_node(blockboard_button).blockboard_click_lock == true:
			blockboard_click_lock = true
			break
		if get_node(blockboard_button).blockboard_click_lock == false:
			blockboard_click_lock = false
	
"

[node name="Blockboard" type="Control"]
layout_mode = 3
anchors_preset = 0
script = SubResource("GDScript_s1kb0")
